<div
  class="container"
  [formGroup]="form">
  <div class="row">
    <div class="col pb-3">
      <h4 class="title d-flex justify-content-between align-items-center">
        Perfil de usuario

        <button
          type="button"
          class="btn btn-primary btn-sm px-4"
          [disabled]="isLoading"
          (click)="save()">
          <i class="bx bx-save"></i>
          Guardar
        </button>
      </h4>

      <div class="row align-items-stretch">
        <div class="col-md-3">
          <div
            class="list-group"
            id="v-pills-tab"
            role="tablist">
            <div
              class="list-group-item list-group-item-action cursor-pointer active"
              data-bs-toggle="pill"
              data-bs-target="#v-pills-home"
              role="tab">
              <h5 class="mb-1 fw-light">General</h5>
              <p class="mb-1">Datos principales del usuario</p>
            </div>
            <div
              class="list-group-item list-group-item-action cursor-pointer"
              data-bs-toggle="pill"
              data-bs-target="#v-pills-profile"
              role="tab">
              <h5 class="mb-1 fw-light">Usuarios</h5>
              <p class="mb-1">Credenciales de acceso</p>
            </div>
          </div>
          <div class="list-group mt-4">
            <div
              class="list-group-item active py-3"
              aria-current="true">
              <h6 class="m-0">Recomendaciones</h6>
            </div>
            <div class="list-group-item">
              <span class="bx bx-bulb bx-lg text-warning float-start"></span>
              Tu Perfil de usuario permitirá administrar actividades en el sistema.
              <br />
              <br />
              No olvides
              <strong>Guardar</strong>
              tu información después de modificar.
            </div>
          </div>
        </div>
        <div class="col-md">
          <div
            class="tab-content h-100"
            id="v-pills-tabContent"
            [class.loading]="isLoading">
            <div
              class="tab-pane show active h-100"
              id="v-pills-home"
              role="tabpanel">
              <div class="card card-body">
                <div class="row g-2">
                  <div class="col-md-4 mb-3">
                    <label class="form-label">Nombres</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="Nombres"
                      maxlength="250"
                      [class.is-invalid]="form.get('Nombres').touched && form.get('Nombres').errors" />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label class="form-label">Apellido Paterno</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="ApePaterno"
                      maxlength="250"
                      [class.is-invalid]="form.get('ApePaterno').touched && form.get('ApePaterno').errors" />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label class="form-label">Apellido Materno</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="ApeMaterno"
                      maxlength="250"
                      [class.is-invalid]="form.get('ApeMaterno').touched && form.get('ApeMaterno').errors" />
                  </div>
                </div>
                <div class="row g-2">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Documento</label>
                    <div class="row g-1">
                      <div class="col-auto">
                        <select
                          class="form-select"
                          formControlName="IdTipoDocumento"
                          [class.is-invalid]="form.get('IdTipoDocumento').touched && form.get('IdTipoDocumento').errors">
                          <option [value]="1">DNI</option>
                          <option [value]="2">Carnet extranjería</option>
                          <option [value]="3">Pasaporte</option>
                        </select>
                      </div>
                      <div class="col">
                        <input
                          type="text"
                          class="form-control"
                          formControlName="NroDocumento"
                          maxlength="20"
                          [class.is-invalid]="form.get('NroDocumento').touched && form.get('NroDocumento').errors" />
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <label class="form-label">Género</label>
                    <select
                      class="form-select"
                      formControlName="Genero">
                      <option value="M">Masculino</option>
                      <option value="F">Femenino</option>
                    </select>
                  </div>
                  <div class="col-md-3 mb-3">
                    <label class="form-label">Fecha Nacimiento</label>
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        bsDatepicker
                        formControlName="FechaNacimiento" />
                      <div class="input-group-text">
                        <i class="bx bx-calendar"></i>
                      </div>
                    </div>
                  </div>
                </div>
                <h6 class="fw-bold mt-3">Datos de contacto</h6>
                <div class="row g-2">
                  <div class="col-md-4 mb-3">
                    <label class="form-label">Celular</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="Celular"
                      maxlength="50" />
                  </div>
                  <div class="col-md-8 mb-3">
                    <label class="form-label">Email</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="Email"
                      maxlength="250" />
                  </div>
                </div>
                <div class="row g-2">
                  <div class="col-md-12 mb-3">
                    <label class="form-label">Dirección</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="Direccion"
                      maxlength="250" />
                  </div>
                </div>
              </div>
            </div>
            <div
              class="tab-pane"
              id="v-pills-profile"
              role="tabpanel">
              <div class="d-flex justify-content-between align-items-center pb-2 border-bottom mb-3">
                <h5 class="m-0 fw-light">Lista de usuarios</h5>
                @if (user?.isAdmin()) {
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm rounded-pill"
                    (click)="addUser()">
                    Agregar usuario
                  </button>
                }
              </div>

              @if (form.get("Usuarios").value?.length) {
                <div class="row align-items-stretch g-2">
                  @for (item of form.get("Usuarios").value; track item.IdUsuario; let i = $index) {
                    <div class="col-md-4 mb-1">
                      <div class="card card-body h-100 border shadow-sm">
                        <div class="row">
                          <div class="col-auto">
                            <i class="bx bx-user bx-lg"></i>
                          </div>
                          <div class="col">
                            <h3 class="user-name">{{ item.IdUsuario }}</h3>
                            <div class="text-muted">{{ item.Tipo }}</div>
                            <div class="mt-2">
                              <a
                                class="btn btn-link btn-sm p-0 me-2"
                                (click)="editUser(item, i)">
                                Editar
                              </a>
                              @if (user?.isAdmin()) {
                                <a
                                  class="btn btn-link btn-sm p-0"
                                  (click)="removeUser(item, i)">
                                  Eliminar
                                </a>
                              }
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <p class="my-4 text-center">No hay usuarios agregados aún</p>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
